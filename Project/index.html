<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 16px; background:#f7fafc; color:#0f172a; }
    .container { max-width:900px; margin: 0 auto; background:white; padding:18px; box-shadow: 0 6px 18px rgba(15,23,42,0.08); border-radius:8px; }
    h1 { font-size:20px; margin:0 0 8px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    label { font-size:13px; color:#334155; display:block; margin-bottom:6px; }
    input[type="text"], input[type="date"], select, textarea { width:100%; padding:8px; border-radius:6px; border:1px solid #e2e8f0; font-size:14px; box-sizing:border-box; }
    textarea { min-height:60px; resize:vertical; }
    .full { grid-column: 1 / -1; }
    .signature-area { border:1px dashed #cbd5e1; border-radius:8px; padding:8px; background:#f8fafc; }
    #sig-canvas, #admin-canvas, .list-canvas { width:100%; touch-action:none; background:white; border-radius:6px; border:1px solid #cbd5e1; display:block; }
    .buttons { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
    button { padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
    .btn-primary { background:#2563eb; color:white; }
    .btn-ghost { background:#e2e8f0; color:#0f172a; }
    .muted { color:#64748b; font-size:13px; margin-top:6px; }
    footer { margin-top:14px; font-size:13px; color:#475569; }
    .small { font-size:13px; color:#475569; }
    .two-line { display:flex; gap:12px; }
    .field-note { font-size:12px; color:#64748b; margin-top:4px; }
    .list-container { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .list-container input { flex:1; }
    @media (max-width:700px) { .grid{ grid-template-columns: 1fr; } .two-line{ flex-direction:column; } }
  </style>
</head>
<body>
<div class="container">

  <h1>IT Asset Sign-Out Form</h1>
  <p class="muted">Fill details, sign below using finger / mouse or type name, then generate PDF to download.</p>

  <form id="assetForm" onsubmit="return false;">
    <div class="grid">

      <div>
        <label>Employee Name</label>
        <input type="text" id="emp_name" placeholder="Full name" />
      </div>

      <div>
        <label>Department</label>
        <input type="text" id="department" placeholder="Department" />
      </div>

      <div>
        <label>Date of Joining</label>
        <input type="date" id="doj" />
      </div>

      <div>
        <label>Employment Type</label>
        <select id="emp_type">
          <option value="">Select</option>
          <option>Permanent</option>
          <option>Contract</option>
          <option>Intern</option>
          <option>Other</option>
        </select>
      </div>

      <div>
        <label>Designation</label>
        <input type="text" id="designation" placeholder="e.g. IT Support" />
      </div>

      <div>
        <label>Previously Used By</label>
        <input type="text" id="prev_emp_name" placeholder="Previous employee" />
      </div>

      <div>
        <label>Previous User Company</label>
        <input type="text" id="prev_company" />
      </div>

      <div>
        <label>Previous User Department</label>
        <input type="text" id="prev_department" />
      </div>

      <div class="full">
        <label>Asset Descriptions</label>
        <textarea id="asset_desc" placeholder="Laptop; Charger; Bag"></textarea>
      </div>

      <!-- Serial Numbers -->
      <div class="full">
        <label>Serial Numbers</label>
        <div id="serialList" class="list-container">
          <input type="text" placeholder="Enter serial number" />
        </div>
        <button type="button" onclick="addSerialField()" class="btn-ghost">Add Another Serial</button>
      </div>

      <!-- Inventory Numbers -->
      <div class="full">
        <label>Inventory Numbers</label>
        <div id="invList" class="list-container">
          <input type="text" placeholder="Enter inventory number" />
        </div>
        <button type="button" onclick="addInvField()" class="btn-ghost">Add Another Inventory Number</button>
      </div>

      <div>
        <label>Date Returned</label>
        <input type="date" id="date_returned" />
      </div>

      <div>
        <label>Date Issued</label>
        <input type="date" id="date_issued" />
      </div>

      <!-- Signatures -->
      <div class="full">
        <label>Signatures</label>

        <div class="signature-area">
          <div class="two-line" style="align-items:center; justify-content:space-between;">

            <!-- Employee Signature -->
            <div style="flex:1; margin-right:8px;">
              <div class="small">Employee signature (draw or type)</div>
              <canvas id="sig-canvas"></canvas>

              <input type="text" id="typedSig" placeholder="Type your signature" style="margin-top:6px;" />
              <button type="button" onclick="generateTypedSignature()" class="btn-ghost" style="margin-top:4px;">Generate Signature</button>

              <div class="buttons" style="margin-top:8px;">
                <button type="button" id="clear-sign" class="btn-ghost">Clear</button>
                <button type="button" id="undo-sign" class="btn-ghost">Undo</button>
              </div>
            </div>

            <!-- Admin Signature -->
            <div style="width:220px;">
              <label>Administrator Name</label>
              <input type="text" id="admin_name" />

              <div style="margin-top:12px;">
                <div class="small">Administrator signature (optional)</div>
                <canvas id="admin-canvas" style="height:80px; margin-top:6px;"></canvas>

                <input type="text" id="typedAdminSig" placeholder="Type admin signature" style="margin-top:6px;" />
                <button type="button" onclick="generateTypedAdminSignature()" class="btn-ghost" style="margin-top:4px;">Generate Signature</button>

                <div class="buttons" style="margin-top:8px;">
                  <button type="button" id="clear-admin" class="btn-ghost">Clear</button>
                </div>
              </div>

            </div>

          </div>
        </div>
      </div>

    </div>

    <!-- Form Buttons -->
    <div class="buttons" style="margin-top:14px;">
      <button id="generate" class="btn-primary">Generate PDF</button>
      <button id="reset" class="btn-ghost" type="button">Reset Form</button>
    </div>

    <p class="field-note">Tip: On mobile, fill then tap "Generate PDF".</p>
  </form>

  <footer>
    <div>Built for Burhani Engineers Limited â€” IT Asset Sign-Out</div>
  </footer>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
// === CANVAS SETUP ===
const sigCanvas = document.getElementById("sig-canvas");
const adminCanvas = document.getElementById("admin-canvas");

function fitCanvas(canvas, heightPx = 200) {
  const ratio = Math.max(window.devicePixelRatio || 1, 1);
  canvas.style.width = "100%";
  canvas.style.height = heightPx + "px";
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * ratio;
  canvas.height = rect.height * ratio;
  const ctx = canvas.getContext("2d");
  ctx.scale(ratio, ratio);
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, rect.width, rect.height);
}

function fitAll() {
  fitCanvas(sigCanvas, 200);
  fitCanvas(adminCanvas, 100);
}

window.addEventListener("resize", fitAll);
fitAll();

const signaturePad = new SignaturePad(sigCanvas, { penColor: "black" });
const adminPad = new SignaturePad(adminCanvas, { penColor: "black" });

document.getElementById("clear-sign").onclick = () => signaturePad.clear();
document.getElementById("undo-sign").onclick = () => {
  const data = signaturePad.toData();
  if (data.length) data.pop();
  signaturePad.fromData(data);
};
document.getElementById("clear-admin").onclick = () => adminPad.clear();

// === TYPED SIGNATURE GENERATOR ===
function generateTypedSignature() {
  const text = document.getElementById("typedSig").value;
  const ctx = sigCanvas.getContext("2d");
  ctx.clearRect(0, 0, sigCanvas.width, sigCanvas.height);
  ctx.font = "30px 'Brush Script MT', cursive";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, sigCanvas.width / 2, sigCanvas.height / 2);
}

function generateTypedAdminSignature() {
  const text = document.getElementById("typedAdminSig").value;
  const ctx = adminCanvas.getContext("2d");
  ctx.clearRect(0, 0, adminCanvas.width, adminCanvas.height);
  ctx.font = "24px 'Brush Script MT', cursive";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, adminCanvas.width / 2, adminCanvas.height / 2);
}

// === ADD LIST INPUTS ===
function addSerialField() {
  const list = document.getElementById("serialList");
  const input = document.createElement("input");
  input.placeholder = "Enter serial number";
  list.appendChild(input);
}

function addInvField() {
  const list = document.getElementById("invList");
  const input = document.createElement("input");
  input.placeholder = "Enter inventory number";
  list.appendChild(input);
}

function getVal(id) {
  return document.getElementById(id).value || "";
}

function getListValues(container) {
  return [...document.querySelectorAll(`#${container} input`)]
    .map(i => i.value)
    .filter(v => v)
    .join(", ");
}

// === GENERATE PDF ===
document.getElementById("generate").onclick = () => {
  const data = {
    emp_name: getVal("emp_name"),
    department: getVal("department"),
    doj: getVal("doj"),
    emp_type: getVal("emp_type"),
    designation: getVal("designation"),
    prev_emp_name: getVal("prev_emp_name"),
    prev_company: getVal("prev_company"),
    prev_department: getVal("prev_department"),
    asset_desc: getVal("asset_desc"),
    serials: getListValues("serialList"),
    inv_nums: getListValues("invList"),
    date_returned: getVal("date_returned"),
    date_issued: getVal("date_issued"),
    admin_name: getVal("admin_name")
  };

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });
  const margin = 40;
  let y = 50;

  doc.setFontSize(16);
  doc.text("IT Asset Sign-Out Form - Burhani Engineers Ltd", margin, y);
  y += 25;
  doc.setFontSize(11);

  function writeRow(label, value) {
    doc.setFont(undefined, "bold");
    doc.text(label + ":", margin, y);
    doc.setFont(undefined, "normal");
    doc.text(value || "-", margin + 140, y);
    y += 20;
  }

  writeRow("Employee Name", data.emp_name);
  writeRow("Department", data.department);
  writeRow("Date of Joining", data.doj);
  writeRow("Employment Type", data.emp_type);
  writeRow("Designation", data.designation);

  doc.setFont(undefined, "bold");
  doc.text("Previously Used By:", margin, y);
  y += 20;

  writeRow("Employee", data.prev_emp_name);
  writeRow("Company", data.prev_company);
  writeRow("Department", data.prev_department);

  doc.setFont(undefined, "bold");
  doc.text("Assets / Description", margin, y);
  y += 15;

  doc.setFont(undefined, "normal");
  const desc = doc.splitTextToSize(data.asset_desc, 500);
  doc.text(desc, margin, y);
  y += desc.length * 16;

  writeRow("Serial Numbers", data.serials);
  writeRow("Inventory Numbers", data.inv_nums);
  writeRow("Date Returned", data.date_returned);
  writeRow("Date Issued", data.date_issued);

  y += 25;
  doc.setFont(undefined, "bold");
  doc.text("Signatures", margin, y);
  y += 15;

  if (!signaturePad.isEmpty()) {
    doc.text("Employee Signature:", margin, y + 10);
    doc.addImage(sigCanvas.toDataURL(), "PNG", margin + 140, y - 10, 200, 60);
  } else {
    doc.text("Employee Signature: Not Provided", margin, y);
  }

  y += 80;

  doc.text("Administrator Name:", margin, y);
  doc.text(data.admin_name || "-", margin + 140, y);
  y += 20;

  if (!adminPad.isEmpty()) {
    doc.addImage(adminCanvas.toDataURL(), "PNG", margin, y, 150, 40);
    y += 50;
  } else {
    doc.text("Admin Signature: Not Provided", margin, y);
    y += 20;
  }

  doc.setFontSize(9);
  doc.text(
    "This form was generated digitally by the IT Department.",
    margin,
    800
  );

  const filename = `${data.emp_name.replace(/\s+/g, "_")}_Signout.pdf`;
  doc.save(filename);
};

// RESET
document.getElementById("reset").onclick = () => {
  document.getElementById("assetForm").reset();
  signaturePad.clear();
  adminPad.clear();
};
</script>

</body>
</html>
